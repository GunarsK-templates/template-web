version: '3'

vars:
  APP_NAME: your-web-app

tasks:
  # Development
  install:
    desc: Install dependencies
    cmds:
      - npm install

  dev:
    desc: Start development server
    cmds:
      - npm run dev

  build:
    desc: Build for production
    cmds:
      - npm run build

  preview:
    desc: Preview production build
    cmds:
      - npm run preview

  # Code quality
  lint:
    desc: Run ESLint and auto-fix issues
    cmds:
      - npm run lint

  format:
    desc: Format code with Prettier
    cmds:
      - npm run format

  format:check:
    desc: Check code formatting
    cmds:
      - npx prettier --check "src/**/*.{js,vue,json,md}"

  # Security
  security:audit:
    desc: Run npm security audit (high/critical only)
    cmds:
      - npm audit --audit-level=high

  # Docker
  docker:build:
    desc: Build Docker image
    cmds:
      - docker build -t {{.APP_NAME}}:latest .

  docker:run:
    desc: Run Docker container
    cmds:
      - docker run --rm -p 80:80 {{.APP_NAME}}:latest

  docker:stop:
    desc: Stop Docker container
    cmds:
      - docker stop {{.APP_NAME}} || true

  # CI - Run all checks
  ci:all:
    desc: Run all CI checks
    cmds:
      - task: format
      - task: lint
      - task: build
      - task: security:audit

  # Clean
  clean:
    desc: Clean build artifacts and node_modules
    cmds:
      - cmd: rm -rf dist/ node_modules/
        platforms: [linux, darwin]
      - cmd: if exist dist rmdir /s /q dist
        platforms: [windows]
        ignore_error: true
      - cmd: if exist node_modules rmdir /s /q node_modules
        platforms: [windows]
        ignore_error: true
